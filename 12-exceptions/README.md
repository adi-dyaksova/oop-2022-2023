# Тема 12, Обработка на изключения, 23.05.2023

## Изключения

```c++
#include <iostream>

int main () {
  try
  {
    throw 20;
  }
  catch (int e)
  {
    std::cout << "An exception occurred. Exception Nr. " << e << '\n';
  }
  return 0;
}
```

## Stack unwinding

```c++
void f1()
{
    cout << "\n f1() Start ";
    throw 100;
    cout << "\n f1() End ";
}
  
void f2()
{
    cout << "\n f2() Start ";
    f1();
    cout << "\n f2() End ";
}
  
void f3()
{
    cout << "\n f3() Start ";
    try {
        f2();
    }
    catch (int i) {
        cout << "\n Caught Exception: " << i;
    }
    cout << "\n f3() End";
}
  
int main()
{
    f3();  
    return 0;
}
```

## std::exception

![Diagram](content/cpp_exceptions.jpg)

## Custom std::exception

```c++
class MyException: public std::exception
{
  const char* what()
  {
    return "My exception happened";
  }
}
```

## FAQ

https://isocpp.org/wiki/faq/exceptions

## Задачи

Целта на днешното упражнение ще е да напишем по-генерална версия на програма за работа със [CSV файлове](https://dev.socrata.com/docs/formats/csv.html).


### Зад. 1 - [Решение](./solutions/)

Да се дефинира клас, който представлява съдържанието на един `csv` файл. Всеки такъв файл си има заглавен ред с имената на колоните и списък от редове. Всеки ред си има номер във файла и списък от клетки. Пример:

| id     | price |
| ----------- | ----------- |
| 123-456      | 33.5       |
| 789-012   | 22        |


Заглавния ред се състои от две колони с имена `id` и `price`. Във файла има два реда. Първият има две клетки - клетка `id` със стойност "123-456" и клетка `price` със стойност "33.5", а вторият - клетка `id` със стойност "789-012" и клетка `price` със стойност "22".

### Зад. 2

Да се имплементира `CSVParser`, който приема име на файл и прочита съдържанието му в класа, описан в предната задача.

### Зад. 3

Добавете шаблонен метод `as` в класа от първата задача, който приема шаблонна функция (ред => T) и който изпълнява функцията върху всеки ред, за да образува списък от обекти от тип Т. Приложете функцията, за да прочетете списък от [хотели](../11-serialization/solutions/hotel/) и списък от [тригълници](../11-serialization/solutions/triangle/).

### Зад. 4

Да се имплементира `CSVWriter`, който приема име на файл и `csv` обект и записва съдържанието му във файла в `csv` формат.

### Зад. 5

Имплементирайте функции, които конвертират списък от хотели/триъгълници в `csv` обект.

### Зад. 6

Напишете тест, който:

1) построява списък от хотели
2) конвертира го в `csv` формат
3) използва `CSVWriter`, за да го запише във файл
4) използва `CSVParser`, за да прочете същия файл
5) използва `as` метода, за да го конвертира към списък от хотели
6) проверява, че началният списък е същият като крайния